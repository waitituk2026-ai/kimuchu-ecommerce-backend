<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Add Product</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px;background:#f5f7fb;color:#111}
    .wrap{max-width:820px;margin:0 auto;padding:12px}
    h1{margin:0 0 12px}
    form{background:#fff;padding:12px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.06)}
    label{display:block;margin-top:10px;font-weight:600}
    input[type="text"], input[type="number"], textarea, select {width:100%;padding:8px;border-radius:6px;border:1px solid #ddd}
    input[type="file"]{margin-top:6px}
    button{background:#0b6;color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;margin-top:12px}
    .small{font-size:.9rem;color:#666}
    .notice{background:#fff8e1;border-left:4px solid #f0c000;padding:8px;margin-top:10px;border-radius:6px}
    .result{margin-top:12px;padding:10px;border-radius:8px;background:#eef7ef;color:#064e12}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Admin — Create Product</h1>
    <div class="notice small">Images will be uploaded to Cloudinary. If Cloudinary env vars are missing your upload will fail — check Render environment variables first.</div>

    <form id="productForm">
      <label>Product name</label>
      <input id="name" name="name" type="text" required />

      <label>Price (KES)</label>
      <input id="price" name="price" type="number" step="0.01" required />

      <label>Category</label>
      <input id="category" name="category" type="text" />

      <label>Description</label>
      <textarea id="description" name="description" rows="4"></textarea>

      <label>Image (optional) — choose file to upload</label>
      <input id="image" name="image" type="file" accept="image/*" />

      <button type="submit">Create Product</button>
    </form>

    <div id="result" class="result" style="display:none"></div>
    <p class="small" style="margin-top:8px"><a href="/admin/orders.html">View orders</a> • <a href="/store">Open store</a></p>
  </div>

  <script>
    // FULL file replacement: posts multipart/form-data to backend
    const API_PRODUCTS = '/api/products'; // relative path — will hit your backend mount on the same host or proxied
    const form = document.getElementById('productForm');
    const result = document.getElementById('result');

    function show(msg, ok = true) {
      result.style.display = 'block';
      result.textContent = msg;
      result.style.background = ok ? '#eef7ef' : '#fdecea';
      result.style.color = ok ? '#064e12' : '#6b0a0a';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.style.display = 'none';

      const fd = new FormData();
      fd.append('name', document.getElementById('name').value);
      fd.append('price', document.getElementById('price').value);
      fd.append('category', document.getElementById('category').value);
      fd.append('description', document.getElementById('description').value);

      const fileInput = document.getElementById('image');
      if (fileInput.files && fileInput.files.length) {
        fd.append('image', fileInput.files[0]);
      }

      try {
        const res = await fetch(API_PRODUCTS, {
          method: 'POST',
          body: fd
        });

        const text = await res.text().catch(()=>null);
        let json = null;
        try { json = JSON.parse(text); } catch(e){}

        if (!res.ok) {
          console.error('Create product failed', res.status, text);
          show('Create failed: ' + (json && json.message ? json.message : (text || res.status)), false);
          return;
        }

        const prod = (json && json.product) ? json.product : json;
        show('Product created: ' + (prod && prod._id ? prod.name + ' (' + prod._id + ')' : 'OK'));
        form.reset();
      } catch (err) {
        console.error('Network error', err);
        show('Network error: ' + (err.message || err), false);
      }
    });
  </script>
</body>
</html>
